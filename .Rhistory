filter(cushion == "diff") |>
ggplot(aes(x = x)) +
geom_line(aes(y = est, lty = del)) +
scale_linetype_manual(name = "Deriv.", values = c(2,3), labels = c("G10" = expression(italic(d)^{"(1,0)"}*Gamma), "G01" = expression(italic(d)^{"(0,1)"}*Gamma))) +
labs(y = "Nm/Kg",
x = "% of stance phase")
ggsave("biomechanics/grafics/biomechanics_del_var_diff.pdf", device = "pdf", unit = "in", width = 5, height = 3.8)
##### estimation of the covariance kernel of the difference #####
p.eval = 25
cov_weights = biLocPol::local_polynomial_weights(p, 0.2, p.eval, F, m = 2, del = 1)
Z = observation_transformation(diff.mat)
cov_est = eval_weights(cov_weights, Z)[,,1]
cov_01_est = eval_weights(cov_weights, Z)[,,2]
x.eval = (1:p.eval - 0.5)/p.eval
plot_ly() |>
add_surface(x = ~x.eval, y = ~x.eval, z = cov_est)
UP = upper.tri(cov_01_est, diag = T)
cov_01_est_up = cov_01_est
cov_01_est_dn = cov_01_est
cov_01_est_dn[UP] = NA
cov_01_est_up[!UP] = NA
plot_ly() %>%
add_surface(x = ~ time, y = ~ time, z = cov_01_est_up) %>%
add_surface(x = ~ time, y = ~ time, z = cov_01_est_dn)
##### Figure 3.18(a) #####
del_var_tib |>
filter(cushion != "diff") |>
ggplot(aes(x = x)) +
geom_line(aes(y = est, color = cushion, lty = del))+
scale_linetype_manual(name = "Deriv.", values = c(2,3), labels = c("G10" = expression(italic(d)^{"(1,0)"}*Gamma), "G01" = expression(italic(d)^{"(0,1)"}*Gamma))) +
scale_colour_manual(values = c("red", "blue")) +
labs(y = "Nm/Kg",
x = "% of stance phase") +
my_theme
ggsave("biomechanics/grafics/biomechanics_del_var_normal_extra.pdf", device = "pdf", unit = "in", width = 5, height = 3.8)
##### Figure 3.17(a) #####
var_tib |>
filter(cushion != "diff") |>
ggplot(aes(x = x)) +
geom_line(aes(y = var, color = cushion, linetype = cushion)) +
labs(y = "Nm/Kg",
x = "% of stance phase") +
scale_linetype_manual(values = c(2,3)) +
scale_colour_manual(values = c("red", "blue")) +
my_theme
ggsave("biomechanics/grafics/biomechanics_var_normal_extra.pdf", device = "pdf", unit = "in", width = 5, height = 3.8)
#### results ####
load("cov/data/estimator_comparison.RData")
#  Figures 3.6
source("cov/functions.r")
#### packages, code ####
library(ggplot2)
library(tidyverse)
library(biLocPol)
my_theme = theme_grey(base_size = 15) +
theme(plot.title = element_text(size = 14))
#### results ####
load("cov/data/estimator_comparison.RData")
#  Figures 3.6
source("cov/functions.r")
##### Figure 8a #####
est_comp |>
filter(n == 100, p == 50, Z == "OU") |>
ggplot(aes(x = h, y = sup.err, pch = estimator, col = m)) +
geom_point() +
lims(y = c(0.03, 1.2)) +
labs(title = "Ornstein-Uhlenbeck", subtitle = "n = 100, p = 50") +
my_theme
##### Figure 8b #####
est_comp |>
filter(n == 100, p == 50, Z == "2rv") |>
ggplot(aes(x = h, y = sup.err, pch = estimator, col = m)) +
geom_point() +
lims(y = c(0.03, 1.1))+
labs(title = "Process 2", subtitle = "n = 100, p = 50") +
my_theme
load("data/bandwidth_comparison_derivative_cov_OU.RData")
bw_comparison_tibble = Reduce(rbind, bw_comparison)
load("cov/data/bandwidth_comparison_derivative_cov_OU.RData")
bw_comparison_tibble = Reduce(rbind, bw_comparison)
colnames(bw_comparison_tibble) = c("n", "p", "h", "sup.err")
bw_comparison_tibble = bw_comparison_tibble %>%
as_tibble() %>%
mutate(p = as.factor(p))
ggplot(bw_comparison_tibble) +
geom_point(aes(x = h, y = sup.err, col = p)) +
lims(y = c(0, 10.4)) +
facet_wrap(n ~., nrow = 1)
ggsave("cov/grafics/bw_comp_cov_deriv_OU.pdf", device = "pdf", unit = "in", width = 8, height = 5)
ggplot(bw_comparison_tibble) +
geom_point(aes(x = h, y = sup.err, col = p)) +
lims(y = c(0, 10.4)) +
facet_wrap(n ~., nrow = 1) +
my_theme
ggsave("cov/grafics/bw_comp_cov_deriv_OU.pdf", device = "pdf", unit = "in", width = 8, height = 5)
library(ffscb)
library(tidyverse)
library(reshape2)
library(locpol)
library(biLocPol)
library(plotly)
library(MASS)
my_theme = theme_grey(base_size = 15) +
theme(plot.title = element_text(size = 14))
deriv_est_theme = theme_grey(base_size = 15) +
theme(plot.title = element_text(size = 14))
#### load data ####
data("Biomechanics")
Biomechanics
head(Biomechanics)
?Biomechanics
#### preprocess data as for mean estimation  ####
stance_phase = Biomechanics[,1]
extra.mat = t(Biomechanics[, 2:19])
normal.mat = t(Biomechanics[,20:37])
diff.mat = extra.mat - normal.mat
##### estimation of the variance ####
p = 201
p.eval = 201
var_weights = biLocPol::local_polynomial_weights(p, 0.2, p.eval, F, m = 2, del = 1, eval.type = "diagonal")
Z_normal = observation_transformation(normal.mat)
Z_extra  = observation_transformation(extra.mat)
Z_diff  = observation_transformation(diff.mat)
normal_var = eval_weights(var_weights, Z_normal)
extra_var  = eval_weights(var_weights, Z_extra)
diff_var = eval_weights(var_weights, Z_diff)
var_tib = tibble( x   = rep(stance_phase, 3),
var = c(normal_var[,1],
extra_var[,1],
diff_var[,1]),
cushion = gl(3, p.eval, labels = c("normal", "extra", "diff")))
##### Figure 3.17(a) #####
var_tib |>
filter(cushion != "diff") |>
ggplot(aes(x = x)) +
geom_line(aes(y = var, color = cushion, linetype = cushion)) +
labs(y = "Nm/Kg",
x = "% of stance phase") +
scale_linetype_manual(values = c(2,3)) +
scale_colour_manual(values = c("red", "blue")) +
my_theme
ggsave("biomechanics/grafics/biomechanics_var_normal_extra.pdf", device = "pdf", unit = "in", width = 5, height = 3.8)
##### Figure 3.17(b) #####
var_tib |>
filter(cushion == "diff") |>
ggplot(aes(x = x)) +
geom_line(aes(y = var, linetype = cushion)) +
labs(y = "Nm/Kg",
x = "% of stance phase") +
my_theme
ggsave("biomechanics/grafics/biomechanics_var_diff.pdf", device = "pdf", unit = "in", width = 5, height = 3.8)
del_var_tib  = tibble(x    = rep(stance_phase, 6),
est = c(normal_var[,2], normal_var[,3],
extra_var[,2], extra_var[,3],
diff_var[,2], diff_var[,3]),
del = rep(gl(2, p.eval, labels = c("G10", "G01")), 3),
cushion = gl(3, 2*p.eval, labels = c("normal", "extra", "diff")))
##### Figure 3.18(a) #####
del_var_tib |>
filter(cushion != "diff") |>
ggplot(aes(x = x)) +
geom_line(aes(y = est, color = cushion, lty = del))+
scale_linetype_manual(name = "Deriv.", values = c(2,3), labels = c("G10" = expression(italic(d)^{"(1,0)"}*Gamma), "G01" = expression(italic(d)^{"(0,1)"}*Gamma))) +
scale_colour_manual(values = c("red", "blue")) +
labs(y = "Nm/Kg",
x = "% of stance phase") +
my_theme
ggsave("biomechanics/grafics/biomechanics_del_var_normal_extra.pdf", device = "pdf", unit = "in", width = 5, height = 3.8)
##### Figure 3.18(b) #####
del_var_tib |>
filter(cushion == "diff") |>
ggplot(aes(x = x)) +
geom_line(aes(y = est, lty = del)) +
scale_linetype_manual(name = "Deriv.", values = c(2,3), labels = c("G10" = expression(italic(d)^{"(1,0)"}*Gamma), "G01" = expression(italic(d)^{"(0,1)"}*Gamma))) +
labs(y = "Nm/Kg",
x = "% of stance phase") +
my_theme
ggsave("biomechanics/grafics/biomechanics_del_var_diff.pdf", device = "pdf", unit = "in", width = 5, height = 3.8)
load("C:/Users/mberger.PC12599/HESSENBOX/GitHub/FDA-Covariance-Estimator/data/bandwidth_comparison_derivative_cov_2rv.RData")
load("C:/Users/mberger.PC12599/HESSENBOX/GitHub/FDA-Covariance-Estimator/data/bandwidth_comparison_derivative_cov_OU.RData")
#### results ####
load("cov/data/bandwidth_comparison_derivative_cov_OU.RData")
#### results ####
load("cov/data/bandwidth_comparison_derivative_cov_OU.RData")
rm(weight)
dimnames(error_decomp_arr) = list(p.seq, c("eps", "dsc", "prc", "mix", "sup"), n.seq)
err_dec_tib = error_decomp_arr %>%
apply(2, rbind) %>%
as_tibble() %>%
mutate(n = rep(n.seq, each = 4),
p = rep(p.seq, 4),
h = bw_comparison_tibble |>
group_by(n, p) |>
slice_min(sup.err) |>
pull(h)) %>%
pivot_longer(1:5, names_to = "term", values_to = "sup.err")
library(biLocPol) # please install this package from Github first. See "README.md" file for instructions
library(future.apply)
library(tidyverse)
library(tictoc)
library(plotly)
dimnames(error_decomp_arr) = list(p.seq, c("eps", "dsc", "prc", "mix", "sup"), n.seq)
err_dec_tib = error_decomp_arr %>%
apply(2, rbind) %>%
as_tibble() %>%
mutate(n = rep(n.seq, each = 4),
p = rep(p.seq, 4),
h = bw_comparison_tibble |>
group_by(n, p) |>
slice_min(sup.err) |>
pull(h)) %>%
pivot_longer(1:5, names_to = "term", values_to = "sup.err")
err_dec_tib %>%
ggplot() +
geom_line(aes(x = p, y = sup.err, col = term, lty = term)) +
facet_wrap(n~., nrow = 1)
err_dec_tib %>%
ggplot() +
geom_line(aes(x = n, y = sup.err, col = term, lty = term)) +
facet_wrap(p ~., nrow = 1)
ggsave("cov/grafics/error_decomp_cov_deriv_OU.pdf", device = "pdf", unit = "in", width = 10, height = 5.5)
##### Figure 3.11 ####
err_dec_tib %>%
ggplot(aes(x = n, y = sup.err, col = term, lty = term, pch = term)) +
geom_line() +
geom_point() +
facet_wrap(p ~., nrow = 1)
ggsave("cov/grafics/error_decomp_cov_deriv_OU.pdf", device = "pdf", unit = "in", width = 10, height = 5.5)
library(plotly)
library(tidyverse)
library(biLocPol)
#### results ####
load("cov/data/illustrations.RData")
##### Load Data #####
# instead of evaluating the functions all again the results can be loaded with
load("cov/data/illustrations.RData")
##### Processes #####
# Figure of paths of the processes of the second process
# not contained in the paper
set.seed(134)
# plot empirical covariances with covariance kernel
###### Figure 1 ######
figure31 = plot_ly(df.all, x = ~Var1, y = ~Var2, z = ~Z.all, size = .4) |>
add_markers() |>
add_surface(x = x, y = x, z = cov.ou.eval,
colors = c('#BF382A', '#0C4B8E'), alpha = .3) |>
layout(scene = list(xaxis = list(title = ""),
yaxis = list(title = ""),
zaxis = list(title = "")))
figure31
#### results ####
load("cov/data/bandwidth_comparison_derivative_cov_OU.RData")
my_theme = theme_grey(base_size = 15) +
theme(plot.title = element_text(size = 14))
##### Figure 3.11 ####
err_dec_tib %>%
ggplot(aes(x = n, y = sup.err, col = term, lty = term, pch = term)) +
geom_line() +
geom_point() +
facet_wrap(p ~., nrow = 1) +
my_theme
#### results ####
load("cov/data/bandwidth_comparison_derivative_cov_OU.RData")
dimnames(error_decomp_arr) = list(p.seq, c("eps", "dsc", "prc", "mix", "sup"), n.seq)
err_dec_tib = error_decomp_arr %>%
apply(2, rbind) %>%
as_tibble() %>%
mutate(n = rep(n.seq, each = 4),
p = rep(p.seq, 4),
h = bw_comparison_tibble |>
group_by(n, p) |>
slice_min(sup.err) |>
pull(h)) %>%
pivot_longer(1:5, names_to = "term", values_to = "sup.err")
err_dec_tib %>%
ggplot() +
geom_line(aes(x = p, y = sup.err, col = term, lty = term)) +
facet_wrap(n~., nrow = 1)
##### Figure 3.11 ####
err_dec_tib %>%
ggplot(aes(x = n, y = sup.err, col = term, lty = term, pch = term)) +
geom_line() +
geom_point() +
facet_wrap(p ~., nrow = 1) +
my_theme
ggsave("cov/grafics/error_decomp_cov_deriv_OU.pdf", device = "pdf", unit = "in", width = 10, height = 5.5)
save.image("cov/data/results_3_11.RData")
#### results ####
load("cov/data/results_3_11.RData")
library(biLocPol) # please install this package from Github first. See "README.md" file for instructions
library(future.apply)
library(tidyverse)
library(tictoc)
library(plotly)
library(tictoc)
library(plotly)
my_theme = theme_grey(base_size = 15) +
theme(plot.title = element_text(size = 14))
#### results ####
load("cov/data/results_3_11.RData")
#### functions ####
source("cov/functions.R")
#### results ####
load("cov/data/illustrations.RData")
##### Load Data #####
# instead of evaluating the functions all again the results can be loaded with
load("cov/data/illustrations.RData")
#### results ####
# instead of evaluating the functions all again the results can be loaded with
load("cov/data/illustrations.RData")
# plot empirical covariances with covariance kernel
###### Figure 1 ######
figure31 = plot_ly(df.all, x = ~Var1, y = ~Var2, z = ~Z.all, size = .4) |>
add_markers() |>
add_surface(x = x, y = x, z = cov.ou.eval,
colors = c('#BF382A', '#0C4B8E'), alpha = .3) |>
layout(scene = list(xaxis = list(title = ""),
yaxis = list(title = ""),
zaxis = list(title = "")))
figure31
save_image("cov/grafics/test.pdf")
reticulate::py_config()
library(plotly)
library(tidyverse)
library(biLocPol) # please install this package from Github first. See "README.md" file for instructions
#### results ####
# instead of evaluating the functions all again the results can be loaded with
load("cov/data/illustrations.RData")
# plot empirical covariances with covariance kernel
###### Figure 1 ######
figure31 = plot_ly(df.all, x = ~Var1, y = ~Var2, z = ~Z.all, size = .4) |>
add_markers() |>
add_surface(x = x, y = x, z = cov.ou.eval,
colors = c('#BF382A', '#0C4B8E'), alpha = .3) |>
layout(scene = list(xaxis = list(title = ""),
yaxis = list(title = ""),
zaxis = list(title = "")))
figure31
save_image("cov/grafics/test.pdf")
reticulate::py_config()
figure31 |>
save_image("cov/grafics/test.pdf")
save_image(figure31, file = "cov/grafics/test.pdf")
reticulate::py_config()
reticulate::py_module_available("plotly")
figure31
# the following needs the setup to python... otherwise use the export function from the viewer
save_image(figure31, file = "cov/grafics/test.pdf")
# the following needs the setup to python... otherwise use the export function from the viewer
# front shot
save_image(figure31, file = "cov/grafics//OU_observation_n100p40theta3sigma2sd075_front.pdf")
# back shot
save_image(figure31, file = "cov/grafics//OU_observation_n100p40theta3sigma2sd075_back.pdf")
##### Figure 3.2 #####
figure32a = plot_ly(df.all, x = ~Var1, y = ~Var2, z = ~Z.all, size = .4) |>
add_surface(x = x, y = x, z = cov.ou.eval, alpha = .3) |>
add_surface(x = x, y = x, z = est, colorscale = cs2, alpha = .3)|>
layout(scene = list(xaxis = list(title = ""),
yaxis = list(title = ""),
zaxis = list(title = "")))
figure32a
figure32
##### Figure 3.2 #####
figure32 = plot_ly(df.all, x = ~Var1, y = ~Var2, z = ~Z.all, size = .4) |>
add_surface(x = x, y = x, z = cov.ou.eval, alpha = .3) |>
add_surface(x = x, y = x, z = est, colorscale = cs2, alpha = .3)|>
layout(scene = list(xaxis = list(title = ""),
yaxis = list(title = ""),
zaxis = list(title = "")))
figure32
# front shot
save_image(figure32, file = "cov/grafics/ou_estimate_m1_h03_sd075")
# front shot
save_image(figure32, file = "cov/grafics/ou_estimate_m1_h03_sd075.pdf")
##### Figure 3.2 (b) #####
# compare estimate without the diagonal and without mirroring with actual kernel
figure32b = plot_ly(df.all, x = ~Var1, y = ~Var2, z = ~Z.all, size = .4) |>
add_surface(x = x, y = x, z = cov.ou.eval, alpha = .3) |>
add_surface(x = x, y = x, z = est_standard, colorscale = cs2, alpha = .3)|>
layout(scene = list(xaxis = list(title = ""),
yaxis = list(title = ""),
zaxis = list(title = "")))
figure32b
##### Figure 3.2 (b) #####
# compare estimate without the diagonal and without mirroring with actual kernel
figure32b = plot_ly(df.all, x = ~Var1, y = ~Var2, z = ~Z.all, size = .4) |>
add_surface(x = x, y = x, z = cov.ou.eval, alpha = .3) |>
add_surface(x = x, y = x, z = est_standard, colorscale = cs2, alpha = .3)|>
layout(scene = list(xaxis = list(title = ""),
yaxis = list(title = ""),
zaxis = list(title = "")))
figure32b
figure37a = plot_ly() |>
add_surface(x = ~x,
y = ~x,
z = ~c_val2,
size = .4, alpha = .7) |>
add_surface(x = ~x,
y = ~x,
z = ~est2,
size = .4, alpha = .2, colorscale = cs2) |>
layout(scene = list(xaxis = list(title = ""),
yaxis = list(title = ""),
zaxis = list(title = "")))
figure37a
figure32b
save_image(figure32a, file = "cov/grafics/ou_estimate_m1_h02_full_sd05.pdf")
# plot empirical covariances with covariance kernel
###### Figure 3.1 (a) & (b) ######
figure31 = plot_ly(df.all, x = ~Var1, y = ~Var2, z = ~Z.all, size = .4) |>
add_markers() |>
add_surface(x = x, y = x, z = cov.ou.eval,
colors = c('#BF382A', '#0C4B8E'), alpha = .3) |>
layout(scene = list(xaxis = list(title = ""),
yaxis = list(title = ""),
zaxis = list(title = ""))) |>
layout(scene = list(
camera = list(
eye = list(x = 1.5, y = 1.5, z = 1)  # controls the angle
)
))
figure31
# plot empirical covariances with covariance kernel
###### Figure 3.1 (a) & (b) ######
figure31 = plot_ly(df.all, x = ~Var1, y = ~Var2, z = ~Z.all, size = .4) |>
add_markers() |>
add_surface(x = x, y = x, z = cov.ou.eval,
colors = c('#BF382A', '#0C4B8E'), alpha = .3) |>
layout(scene = list(xaxis = list(title = ""),
yaxis = list(title = ""),
zaxis = list(title = ""))) |>
layout(scene = list(
camera = list(
eye = list(x = 10, y = 1.5, z = 1)  # controls the angle
)
))
figure31
# plot empirical covariances with covariance kernel
###### Figure 3.1 (a) & (b) ######
figure31 = plot_ly(df.all, x = ~Var1, y = ~Var2, z = ~Z.all, size = .4) |>
add_markers() |>
add_surface(x = x, y = x, z = cov.ou.eval,
colors = c('#BF382A', '#0C4B8E'), alpha = .3) |>
layout(scene = list(xaxis = list(title = ""),
yaxis = list(title = ""),
zaxis = list(title = ""))) |>
layout(scene = list(
camera = list(
eye = list(x = 2, y = 2, z = 1)  # controls the angle
)
))
figure31
# plot empirical covariances with covariance kernel
###### Figure 3.1 (a) & (b) ######
figure31 = plot_ly(df.all, x = ~Var1, y = ~Var2, z = ~Z.all, size = .4) |>
add_markers() |>
add_surface(x = x, y = x, z = cov.ou.eval,
colors = c('#BF382A', '#0C4B8E'), alpha = .3) |>
layout(scene = list(xaxis = list(title = ""),
yaxis = list(title = ""),
zaxis = list(title = ""))) |>
layout(scene = list(
camera = list(
eye = list(x = 2, y = 0, z = 1)  # controls the angle
)
))
# plot empirical covariances with covariance kernel
###### Figure 3.1 (a) & (b) ######
figure31 = plot_ly(df.all, x = ~Var1, y = ~Var2, z = ~Z.all, size = .4) |>
add_markers() |>
add_surface(x = x, y = x, z = cov.ou.eval,
colors = c('#BF382A', '#0C4B8E'), alpha = .3) |>
layout(scene = list(xaxis = list(title = ""),
yaxis = list(title = ""),
zaxis = list(title = "")))
figure31 |>
layout(scene = list(
camera = list(
eye = list(x = 2, y = 0, z = 1)  # controls the angle
)
))
figure31 |>
layout(scene = list(
camera = list(
eye = list(x = 1, y = 0.5, z = 1)  # controls the angle
)
))
plotly_build(fig)$x$layout$scene$camera
figure31
plotly_build(figure31)$x$layout$scene$camera
# plot empirical covariances with covariance kernel
###### Figure 3.1 (a) & (b) ######
figure31 = plot_ly(df.all, x = ~Var1, y = ~Var2, z = ~Z.all, size = .4) |>
add_markers() |>
add_surface(x = x, y = x, z = cov.ou.eval,
colors = c('#BF382A', '#0C4B8E'), alpha = .3) |>
layout(scene = list(xaxis = list(title = ""),
yaxis = list(title = ""),
zaxis = list(title = "")))
figure31
plotly_build(figure31)$x$layout$scene$camera
plotly_build(figure31)$x$layout$scene$
plotly_build(figure31)$x$layout$scene
plotly_build(figure31)$x$layout$scene
plotly_build(figure31)$x$layout
plotly_build(figure31)$x
plotly_build(figure31)$x$layout$scene$camera
plotly_build(figure31)$x$layout$scene$
plotly_build(figure31)$x$layout$scene$camera
plotly_build(figure31)$x$layout$scene
plotly_build(figure31)$x$layout$scene$xaxis
plotly_build(figure31)$x$layout$scene$xaxis$title
